<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Shopify - Sprie Widget Docs</title>
<meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://docs.sprie.io/favicon.png><link rel=stylesheet href=/css/style.min.c0c5bdcc13e1ec0af46d8fb01468bc0865f94e32016b28486e9fdf359cc41af2.css></head><body class='page page-default-single'><div id=main-menu-mobile class=main-menu-mobile><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-sprie widget"><a href=/widget/><span>Sprie Widget</span></a></li><li class="menu-item-sprie embed"><a href=/embed/><span>Sprie Embed</span></a></li></ul></div><div class=wrapper><div class=header><div class=container><div class=logo><a href=https://docs.sprie.io/><img width=70 height=70 alt=Logo src=/images/logo.png></a></div><div class=logo-mobile><a href=https://docs.sprie.io/><img width=70 height=70 alt=Logo src=/images/logo.png></a></div><div id=main-menu class=main-menu><ul><li class=menu-item-home><a href=/><span>Home</span></a></li><li class="menu-item-sprie widget"><a href=/widget/><span>Sprie Widget</span></a></li><li class="menu-item-sprie embed"><a href=/embed/><span>Sprie Embed</span></a></li></ul></div><button id=toggle-main-menu-mobile class="hamburger hamburger--slider" type=button>
<span class=hamburger-box><span class=hamburger-inner></span></span></button></div></div><div class="container pt-2 pt-md-6 pb-3 pb-md-6"><div class=row><div class="col-12 col-md-3 mb-3"><div class=sidebar><div class=docs-menu><h4>Widget</h4><ul><li><a href=https://docs.sprie.io/widget/concept/>Concepts</a></li><li><a href=https://docs.sprie.io/widget/quick-start/>Quick Start Guide</a></li><li><a href=https://docs.sprie.io/widget/events/>Events</a></li><li><a href=https://docs.sprie.io/widget/methods/>Methods</a></li><li><a href=https://docs.sprie.io/widget/wordpress/>Wordpress</a></li><li class=active><a href=https://docs.sprie.io/widget/shopify/>Shopify</a></li><li><a href=https://docs.sprie.io/widget/demos/>Live Demos</a></li></ul></div></div></div><div class="col-12 col-md-9"><h1 class=title>Shopify</h1><div class=content><p>Shopify is an eCommerce website to sell, ship, and process payments. All the activities in Sprie happen in front end. What we can do is break the typical Sprie Workflow into several <code>liquid</code> files so that they all take care of specific actions on specific intents.</p><p><strong>Note:</strong> This page is designed to be used as a reference for the Shopify implementation. The code below uses outdated Liquid v1, but can be adapted for the Liquid v2. This page will be updated soon with Liquid v2.</p><h2 id=summary>Summary</h2><ul><li><a href=#summary>Summary</a></li><li><a href=#implementation>Implementation</a><ul><li><a href=#initialise>Initialise</a></li><li><a href=#add-tryon-button>Add TryOn Button</a></li><li><a href=#check-sku-registration>Check SKU Registration</a></li><li><a href=#handle-add-to-cart>Handle Add to Cart</a></li><li><a href=#handle-variants-changes>Handle Variants changes</a></li><li><a href=#show-on-collections-page>Show on Collections Page</a></li></ul></li><li><a href=#full-reference-code>Full Reference Code</a></li></ul><h2 id=implementation>Implementation</h2><p>All the implementation work requires you to edit <code>.liquid</code> files, right off the admin editor:</p><ol><li>Go to <code>&lt;your-shopify-store>/admin</code> page and login (<code>https://mystore.myshopify.com/admin</code>)</li><li><code>Online Store > Themes > Actions > Edit Code</code></li><li>Select file from left Column, Edit/update/insert the code and click on <code>Save</code> on top right.</li></ol><p><img src=location.jpg alt="Code Editor Location" title="Location of Code Editor"></p><h3 id=initialise>Initialise</h3><p>We would want to initialise Sprie Widget in a place where that particular part of html gets rendered on every single page.
&lsquo;footer.liquid&rsquo; is a very good way to start initialising the widget.
Insert the follwing code in <code>sections > footer.liquid</code> file :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=c>&lt;!-- Sprie --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.jsdelivr.net/npm/@perceptimagery/sprie-widget@latest?apikey={apikey}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=add-tryon-button>Add TryOn Button</h3><p>The <code>Preview</code> TryOn Button should be available where the main product is displayed (PDP - Product Display Page).
Head on to <code>sections > main-product.liquid</code> and put the following code around line number <code>440</code> buy buttons in <code>product-form__buttons</code> element :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl> <span class=na>id</span><span class=o>=</span><span class=s>&#34;tryon-button&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>name</span><span class=o>=</span><span class=s>&#34;tryon&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span> 
</span></span><span class=line><span class=cl> <span class=na>onclick</span><span class=o>=</span><span class=s>&#34;SprieSDK.Load(currentVariantSku)&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product-form__submit button button--full-width button--secondary&#34;</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span> Try on <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>We will add <code>currentVariantSku</code> variable in the following steps.</p><p><img src=tryon-button.png alt=tryon-button></p><h3 id=check-sku-registration>Check SKU Registration</h3><p>Sprie authentication happens under the hood with the api key provided, and its an asynchronous task. Sprie exposes certain <a href=https://docs.sprie.io/docs/events>events</a> to let the developers know when certain actions happen, and how to listen to them.<br>In this case, we tap on to <code>onSDKReady</code> event to know when the authentication is done and Sprie is ready for use. Put the below code in the same <code>sections > footer.liquid</code> file after the above step.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JS data-lang=JS><span class=line><span class=cl><span class=c1>// Check SKU is registered
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>CheckSKU</span><span class=p>(){</span>
</span></span><span class=line><span class=cl> <span class=c1>// Check product registration if inside product page
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=k>if</span><span class=p>(</span><span class=nx>currentVariantSku</span> <span class=o>&amp;&amp;</span> <span class=nx>tryonButton</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=nx>tryonButton</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=s2>&#34;none&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>SprieSDK</span><span class=p>.</span><span class=nx>CheckSKU</span><span class=p>(</span><span class=nx>currentVariantSku</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>checkResult</span><span class=p>=&gt;{</span>
</span></span><span class=line><span class=cl>  <span class=nx>tryonButton</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=nx>checkResult</span><span class=p>[</span><span class=nx>productSku</span><span class=p>]</span><span class=o>?</span><span class=s2>&#34;block&#34;</span><span class=o>:</span><span class=s2>&#34;none&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Check with server if product is registered
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;SprieEvent:onSDKReady&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>){</span>
</span></span><span class=line><span class=cl> <span class=nx>CheckSKU</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>});</span> 
</span></span></code></pre></div><p>Here, we are listening to <code>onSDKReady</code> event, then checking of productSku is not null, and then using <a href=https://docs.sprie.io/docs/methods>Sprie Methods</a> to check product registration with Sprie. Once the result is received, we immeidtaely show/hide the tryon button that we created in step 2.</p><h3 id=handle-add-to-cart>Handle Add to Cart</h3><p>Sprie offers a Add to Cart CTA on the widget which dispatches an event with the specific product SKU. You can listen to the event and decide the action on the received event. The reason we do not provide any backend action is because Sprie doesn&rsquo;t interfere with the framework you are using and leaves it up to you to decide how you want to implement it.</p><p>As an example, in Shopify setup, you can add it to card in the following way :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JS data-lang=JS><span class=line><span class=cl><span class=c1>// Handle Add to Cart
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>AddToCart</span> <span class=p>(</span><span class=nx>e</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Added to cart: &#39;</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>detail</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nb>window</span><span class=p>.</span><span class=nx>Shopify</span><span class=p>.</span><span class=nx>routes</span><span class=p>.</span><span class=nx>root</span><span class=si>}</span><span class=sb>cart/add.js`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>itemToAdd</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>variantIdSkuMap</span><span class=p>).</span><span class=nx>find</span><span class=p>(</span><span class=nx>x</span><span class=p>=&gt;</span><span class=nx>variantIdSkuMap</span><span class=p>[</span><span class=nx>x</span><span class=p>]</span><span class=o>===</span><span class=nx>currentVariantSku</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>cartBody</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=o>:</span> <span class=nx>itemToAdd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>quantity</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>itemToAdd</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Accept&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json, text/plain, */*&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>cartBody</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;SprieEvent:onAssetCart&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=cl>    <span class=nx>AddToCart</span><span class=p>(</span><span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span></code></pre></div><p>This particular code uses <code>onAssetCart</code> event from Sprie to POST to <code>/wp-json/wc/store/cart/add-item</code> api from woo commerce to add the item to cart usig jQuery&rsquo;s <code>ajax</code> method, which is by default installed in a wordpress setup.</p><h3 id=handle-variants-changes>Handle Variants changes</h3><p>in <code>sections> footer.liquid</code>, put this code after the previous step:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-JS data-lang=JS><span class=line><span class=cl><span class=c1>// Handle Variant Change
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>onVariantChange</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Checked radio with ID = &#39;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>getAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl> <span class=nx>currentVariantSku</span><span class=o>=</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>getAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=nx>CheckSKU</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>variantElements</span><span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelectorAll</span><span class=p>(</span><span class=s1>&#39;input[name=&#34;Color&#34;]&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>({</span><span class=nx>variantElements</span><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=nx>variantElements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=kd>let</span> <span class=nx>selectedVariant</span> <span class=o>=</span> <span class=nx>currentProduct</span><span class=p>.</span><span class=nx>variants</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>variant</span> <span class=p>=&gt;</span> <span class=nx>variant</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>input</span><span class=p>.</span><span class=nx>value</span> <span class=o>||</span> <span class=nx>variant</span><span class=p>.</span><span class=nx>option1</span> <span class=o>===</span> <span class=nx>input</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=nx>input</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>,</span> <span class=nx>selectedVariant</span><span class=p>.</span><span class=nx>sku</span> <span class=o>||</span> <span class=nx>productSku</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=nx>input</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;change&#39;</span><span class=p>,</span> <span class=nx>onVariantChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><p>We check for radio button clicks and run <code>CheckSKU</code> on them and enable the Preview <code>TryOn</code> button accordingly.</p><h3 id=show-on-collections-page>Show on Collections Page</h3><p>To show Try On Button multiple times with each product card, we can use <code>CheckSKUBatch</code> method of Sprie to check mulitple SKUs at once, thus removing redundant API calls to Sprie.
The end result of this section looks like the image below :</p><p><img src=collections-page.png alt=collections-page></p><p>How do we do it?<br>This required editing two files,</p><ol><li>In <code>snippets > card-product.liquid</code>, add the following code arounf Line Number 147 inside <code>.card__information</code> class div. :</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl> <span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl>    <span class=na>id</span><span class=o>=</span><span class=s>&#34;tryon-button&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>name</span><span class=o>=</span><span class=s>&#34;tryon&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>data-sku</span><span class=o>=</span><span class=s>&#34;{{ card_product.handle }}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none; margin-top:1em;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>class</span><span class=o>=</span><span class=s>&#34;button-sprie-tryon button button--small button--secondary&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>onclick</span><span class=o>=</span><span class=s>&#34;SprieSDK.Load(&#39;{{card_product.handle}}&#39;)&#34;</span>  
</span></span><span class=line><span class=cl>    <span class=p>&gt;</span>  Try on 
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>We simple hide the button initially so that later on we can check for the SKU registration and enable it accordingly, in the following step :</p><p>2.<code>sections > main-collection-product-grid.liquid</code>, append the following JS code at bottom :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>sprieBtn</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelectorAll</span><span class=p>(</span><span class=s1>&#39;.button-sprie-tryon&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>products</span><span class=o>=</span><span class=p>{{</span> <span class=nx>collection</span><span class=p>.</span><span class=nx>products</span> <span class=o>|</span> <span class=nx>json</span> <span class=p>}}</span> 
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>productSKUs</span><span class=o>=</span><span class=nx>products</span><span class=p>.</span><span class=nx>map</span><span class=p>(</span><span class=nx>x</span><span class=p>=&gt;</span><span class=nx>x</span><span class=p>.</span><span class=nx>handle</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>StartSKUCheck</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Checking Batch ...&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>SprieSDK</span><span class=p>.</span><span class=nx>CheckSKUBatch</span><span class=p>([...</span><span class=nx>productSKUs</span><span class=p>,</span> <span class=s1>&#39;sample-non-existant-sku&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>result</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=nx>sprieBtn</span><span class=p>.</span><span class=nx>forEach</span><span class=p>(</span><span class=nx>btn</span><span class=p>=&gt;{</span>
</span></span><span class=line><span class=cl>        <span class=nx>btn</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span><span class=o>=</span><span class=nx>result</span><span class=p>[</span><span class=nx>btn</span><span class=p>.</span><span class=nx>getAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>)]</span><span class=o>?</span><span class=s1>&#39;block&#39;</span><span class=o>:</span><span class=s1>&#39;none&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;SprieEvent:onSDKReady&#39;</span><span class=p>,</span>  <span class=nx>StartSKUCheck</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>Here, we are listening for <code>onSDKReady</code> event of Sprie and then using Shopify liquid variable <code>{{ collection.products | json }}</code> to get the product list and running <code>CheckSKUBatch</code> on the SKUs and setting the tryon button to visible accordingly. This can be replicated to Homepage as well.</p><h2 id=full-reference-code>Full Reference Code</h2><p>Code in <code>sections> footer.liquid</code> :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=c>&lt;!-- Sprie --&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;https://cdn.jsdelivr.net/npm/@perceptimagery/sprie-widget@latest?apikey={apikey}&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Utilities
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kr>const</span> <span class=nx>params</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Proxy</span><span class=p>(</span><span class=k>new</span> <span class=nx>URLSearchParams</span><span class=p>(</span><span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>search</span><span class=p>),</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>get</span><span class=o>:</span> <span class=p>(</span><span class=nx>searchParams</span><span class=p>,</span> <span class=nx>prop</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>searchParams</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=nx>prop</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=c1>// Fetch Product Specific Data
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=kr>const</span> <span class=nx>urlPath</span> <span class=o>=</span> <span class=nb>window</span><span class=p>.</span><span class=nx>location</span><span class=p>.</span><span class=nx>pathname</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=kr>const</span> <span class=nx>productSku</span> <span class=o>=</span> <span class=nx>urlPath</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=s1>&#39;products/&#39;</span><span class=p>)</span><span class=o>&gt;=</span><span class=mi>0</span> <span class=o>?</span> <span class=nx>urlPath</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=s1>&#39;products&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>replaceAll</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>).</span><span class=nx>trim</span><span class=p>()</span> <span class=o>:</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>currentVariantId</span> <span class=o>=</span> <span class=nx>params</span><span class=p>.</span><span class=nx>variant</span> <span class=o>||</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>currentProduct</span><span class=o>=</span> <span class=p>{{</span> <span class=nx>product</span> <span class=o>|</span> <span class=nx>json</span> <span class=p>}};</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>variantIdSkuMap</span><span class=o>=</span> <span class=o>!!</span><span class=nx>currentProduct</span>  <span class=o>?</span> <span class=nx>currentProduct</span><span class=p>.</span><span class=nx>variants</span><span class=p>.</span><span class=nx>reduce</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span><span class=nx>curr</span><span class=p>)=&gt;{</span>      
</span></span><span class=line><span class=cl>    <span class=nx>acc</span><span class=p>[</span><span class=nx>curr</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span><span class=o>=</span><span class=nx>curr</span><span class=p>.</span><span class=nx>sku</span> <span class=o>||</span> <span class=nx>productSku</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>acc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>},{})</span><span class=o>:</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>currentVariantSku</span> <span class=o>=</span> <span class=nx>variantIdSkuMap</span><span class=p>[</span><span class=nx>currentVariantId</span><span class=p>]</span> <span class=o>||</span> <span class=nx>productSku</span> <span class=o>||</span> <span class=kc>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>tryonButton</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s1>&#39;tryon-button&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Check SKU is registered
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>function</span> <span class=nx>CheckSKU</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Check product registration if inside product page
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>currentVariantSku</span> <span class=o>&amp;&amp;</span> <span class=nx>tryonButton</span><span class=p>){</span>
</span></span><span class=line><span class=cl>      <span class=nx>tryonButton</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=s2>&#34;none&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=nx>SprieSDK</span><span class=p>.</span><span class=nx>CheckSKU</span><span class=p>(</span><span class=nx>currentVariantSku</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=nx>checkResult</span><span class=p>=&gt;{</span>
</span></span><span class=line><span class=cl>         <span class=nx>tryonButton</span><span class=p>.</span><span class=nx>style</span><span class=p>.</span><span class=nx>display</span> <span class=o>=</span> <span class=nx>checkResult</span><span class=p>[</span><span class=nx>productSku</span><span class=p>]</span><span class=o>?</span><span class=s2>&#34;block&#34;</span><span class=o>:</span><span class=s2>&#34;none&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Check with server if product is registered
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;SprieEvent:onSDKReady&#34;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>e</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>CheckSKU</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=c1>// Handle Add to Cart
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=kd>function</span> <span class=nx>AddToCart</span> <span class=p>(</span><span class=nx>e</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Added to cart: &#39;</span><span class=p>,</span><span class=nx>e</span><span class=p>.</span><span class=nx>detail</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>url</span> <span class=o>=</span> <span class=sb>`</span><span class=si>${</span><span class=nb>window</span><span class=p>.</span><span class=nx>Shopify</span><span class=p>.</span><span class=nx>routes</span><span class=p>.</span><span class=nx>root</span><span class=si>}</span><span class=sb>cart/add.js`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>itemToAdd</span> <span class=o>=</span> <span class=nb>Object</span><span class=p>.</span><span class=nx>keys</span><span class=p>(</span><span class=nx>variantIdSkuMap</span><span class=p>).</span><span class=nx>find</span><span class=p>(</span><span class=nx>x</span><span class=p>=&gt;</span><span class=nx>variantIdSkuMap</span><span class=p>[</span><span class=nx>x</span><span class=p>]</span><span class=o>===</span><span class=nx>currentVariantSku</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>cartBody</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>items</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=nx>id</span><span class=o>:</span> <span class=nx>itemToAdd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>          <span class=nx>quantity</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>itemToAdd</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>fetch</span><span class=p>(</span><span class=nx>url</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;POST&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Accept&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json, text/plain, */*&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span><span class=o>:</span> <span class=nx>JSON</span><span class=p>.</span><span class=nx>stringify</span><span class=p>(</span><span class=nx>cartBody</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=nx>res</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl> <span class=nb>document</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;SprieEvent:onAssetCart&#34;</span><span class=p>,</span> <span class=p>(</span><span class=nx>e</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=cl>    <span class=nx>AddToCart</span><span class=p>(</span><span class=nx>e</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Handle Variant Change
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>function</span> <span class=nx>onVariantChange</span><span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Checked radio with ID = &#39;</span> <span class=o>+</span> <span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>getAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>      <span class=nx>currentVariantSku</span><span class=o>=</span><span class=nx>event</span><span class=p>.</span><span class=nx>target</span><span class=p>.</span><span class=nx>getAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>CheckSKU</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>variantElements</span><span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>querySelectorAll</span><span class=p>(</span><span class=s1>&#39;input[name=&#34;Color&#34;]&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>({</span><span class=nx>variantElements</span><span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=nx>variantElements</span><span class=p>.</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>input</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kd>let</span> <span class=nx>selectedVariant</span> <span class=o>=</span> <span class=nx>currentProduct</span><span class=p>.</span><span class=nx>variants</span><span class=p>.</span><span class=nx>find</span><span class=p>(</span><span class=nx>variant</span> <span class=p>=&gt;</span> <span class=nx>variant</span><span class=p>.</span><span class=nx>name</span> <span class=o>===</span> <span class=nx>input</span><span class=p>.</span><span class=nx>value</span> <span class=o>||</span> <span class=nx>variant</span><span class=p>.</span><span class=nx>option1</span> <span class=o>===</span> <span class=nx>input</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>input</span><span class=p>.</span><span class=nx>setAttribute</span><span class=p>(</span><span class=s1>&#39;data-sku&#39;</span><span class=p>,</span> <span class=nx>selectedVariant</span><span class=p>.</span><span class=nx>sku</span> <span class=o>||</span> <span class=nx>productSku</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>input</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;change&#39;</span><span class=p>,</span> <span class=nx>onVariantChange</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></div><p><code>sections > main-product.liquid</code> :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-HTML data-lang=HTML><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>button</span>
</span></span><span class=line><span class=cl> <span class=na>id</span><span class=o>=</span><span class=s>&#34;tryon-button&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>type</span><span class=o>=</span><span class=s>&#34;button&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>name</span><span class=o>=</span><span class=s>&#34;tryon&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>style</span><span class=o>=</span><span class=s>&#34;display:none&#34;</span> 
</span></span><span class=line><span class=cl> <span class=na>onclick</span><span class=o>=</span><span class=s>&#34;SprieSDK.Load(currentVariantSku)&#34;</span>
</span></span><span class=line><span class=cl> <span class=na>class</span><span class=o>=</span><span class=s>&#34;product-form__submit button button--full-width button--secondary&#34;</span>
</span></span><span class=line><span class=cl> <span class=p>&gt;</span>
</span></span><span class=line><span class=cl> <span class=p>&lt;</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  Try on
</span></span><span class=line><span class=cl> <span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>button</span><span class=p>&gt;</span>
</span></span></code></pre></div></div></div></div></div></div></div><div class=sub-footer><div class=container><div class=row><div class=col-12><div class=sub-footer-inner></div></div></div></div></div><script type=text/javascript src=/js/scripts.min.ec19db7e4836c12e2c5e3697d926bc3e4c22005167d9826aab54feca08f0c093.js></script></body></html>